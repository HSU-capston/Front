plugins {
    id "com.android.application"
    id "kotlin-android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
    id "dev.flutter.flutter-gradle-plugin"
}

android {
    compileSdkVersion 34 // targetSdkVersionê³¼ ë§žì¶°ì£¼ì„¸ìš”
    namespace = "com.example.sporty_up"
    compileSdk = flutter.compileSdkVersion
    ndkVersion = flutter.ndkVersion

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8
    }

    defaultConfig {
        applicationId "com.example.sporty_up"
        minSdkVersion 21  // ìµœì†Œ ì§€ì› Android ë²„ì „ (21 ì´ìƒ ì¶”ì²œ)
        targetSdkVersion 34 // ìµœì‹  ë²„ì „ì— ë§žì¶°ì£¼ì„¸ìš”
        versionCode 1
        versionName "1.0"
    }

    buildTypes {
        release {
            debuggable false
            // TODO: Add your own signing config for the release build.
            // Signing with the debug keys for now, so `flutter run --release` works.
            signingConfig = signingConfigs.debug
        }
    }

    dependencies {
        implementation 'androidx.appcompat:appcompat:1.4.0'  // ìµœì‹  ë²„ì „ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥
    }
}

// ðŸ“Œ **Gradle ë¹Œë“œ ë””ë ‰í† ë¦¬ ì„¤ì • ì¶”ê°€ (ì—¬ê¸°ì— ì¶”ê°€!)**
rootProject.buildDir = '../build'
subprojects {
    project.buildDir = "${rootProject.buildDir}/${project.name}"
    project.evaluationDependsOn(':app')
}

flutter {
    source = "../.."
}

// ðŸ“Œ **APK ë³µì‚¬ ìž‘ì—… ì¶”ê°€**
tasks.configureEach { task ->
    if (task.name == "assembleDebug") {
        task.finalizedBy("copyDebugApkToFlutterExpectedLocation")
    }
}

tasks.register('copyDebugApkToFlutterExpectedLocation') {
    doLast {
        def flavorNames = android.productFlavors.collect { it.name }
        def flavorName = flavorNames.isEmpty() ? "" : flavorNames[0].toLowerCase()
        copy {
            from "${buildDir}/outputs/apk/${flavorName}/debug/app-${flavorName}-debug.apk"
            into "${rootProject.buildDir}/app/outputs/flutter-apk/"
        }
    }
}
